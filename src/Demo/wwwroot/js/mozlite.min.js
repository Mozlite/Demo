(function(n){function i(n){function f(n){return t.md.getAttribute("js-"+n)}function i(){var i=t.getMD(),n;t.preview.innerHTML=marked(i);t.counter&&(n=(t.preview.textContent||t.preview.innerText).length,t.counter.innerHTML=t.counter.getAttribute("js-format").replace("$count",n),t.counter.style.display="block")}var t=this,r,u;this.md=typeof n=="string"?document.querySelector(n):n;this.edit=this.md.querySelector(".mozmd-edit");this.edit.onkeyup=i;this.preview=this.md.querySelector(".mozmd-preview");this.toolbar=this.md.querySelector(".mozmd-toolbar");this.isFullscreen=!1;r=f("counter");r&&(this.counter=document.querySelector(r));this.getMD=function(){return t.edit.innerHTML};this.getHTML=function(){return i(),t.preview.innerHTML};this.append=function(n){typeof n=="function"&&(n=n());this.edit.appendChild(document.createTextNode(n));this.edit.focus();i()};this.replace=function(n,t){var u,r,f,e;n&&(u=getSelection(),u&&u.rangeCount!==0&&u.anchorNode.parentNode===this.edit||this.edit.focus(),r=u.getRangeAt(0),f=r.toString(),r.deleteContents(),typeof n=="function"?f=n(f):r.insertNode(document.createTextNode(n)),e=document.createTextNode(f),r.insertNode(e),t&&r.insertNode(document.createTextNode(t)),r=r.cloneRange(),r.setStartAfter(e),r.collapse(!0),u.removeAllRanges(),u.addRange(r),i())};u={bold:function(){t.replace("__ "," __")},italic:function(){t.replace(" _","_ ")},ol:function(){t.replace(function(n){var i,r,t;if(n){for(i=n.replace(/\r/g,"").split("\n"),r=[],t=0;t<i.length;t++)r.push(t+1+". "+i[t]);return r.join("\r\n")}return"1. "})},ul:function(){t.replace(function(n){var i,r,t;if(n){for(i=n.replace(/\r/g,"").split("\n"),r=[],t=0;t<i.length;t++)r.push("* "+i[t]);return r.join("\r\n")}return"* "})},quote:function(){t.replace(function(n){return n?"\r\n> "+n+"\r\n":"> "})},fullscreen:function(){var n=[];t.isFullscreen=!1;t.md.className.split(" ").forEach(function(i){i!=="mozmd-fullscreen"?n.push(i):t.isFullscreen=!0});t.isFullscreen||n.push("mozmd-fullscreen");t.md.className=n.join(" ")},head:function(){t.replace(function(n){return n&&n[0]==="#"?"#"+n:"# "+n})},quora:function(){t.replace(function(n){return n=n||"","`"+n+"`"})},code:function(){t.replace(function(n){return n=n||"","\r\n``` \r\n"+n+"\r\n```\r\n"})}};this.toolbar.querySelectorAll("button[js-action]").forEach(function(n){n.onclick=function(){u[n.getAttribute("js-action")]()}})}var t=!0;window.IE=!!window.ActiveXObject||"ActiveXObject"in window;window.Moblie=/(iPhone|iPod|Android|ios|SymbianOS)/i.test(navigator.userAgent);window["mozlite-ready-functions"]=[];window.$onready=function(n){window["mozlite-ready-functions"].push(n)};n.fn.checkedVal=function(){var n=[];return this.find("input[type=checkbox], input[type=radio]").each(function(){this.checked&&n.push(this.value)}),n.join(",")};n.fn.dset=function(n,t){var i=this.data(n);return i?this.data(n):(i=t(),this.data(n,i),i)};n.fn.exec=function(t){return this.length>0?this.each(function(){var i=n(this);i.hasClass("no-js")||t(i)}):this};n.fn.createObjectURL=function(){return!this.is("input")||this.attr("type")!=="file"?null:navigator.userAgent.indexOf("MSIE")>0?this.val():window.createObjectURL?window.createObjectURL(this[0].files[0]):window.URL?window.URL.createObjectURL(this[0].files[0]):window.webkitURL?window.webkitURL.createObjectURL(this[0].files[0]):null};n.fn.js=function(n,t){return t?this.attr("js-"+n,t):this.attr("js-"+n)};n.fn.targetElement=function(t){var i=n(this.js("target"));return i.length>0?i:t||this};n.fn.formSubmit=function(i,r){var u=this,s=new FormData(this[0]),f=u.find("[js-submit=true],[type=submit]").attr("disabled","disabled"),e=f.find("i.fa"),o=e.attr("class");e.attr("class","fa fa-spinner fa-spin");n.ajax({type:"POST",url:u.attr("action"),contentType:!1,processData:!1,data:s,success:function(n){if(f.removeAttr("disabled").find("i.fa").attr("class",o),i){i(n,u);return}n.message&&$alert(n.message,n.type,function(){n.data&&n.data.url?location.href=n.data.url:n.type==="success"&&(location.href=location.href)})},error:function(n){if(f.removeAttr("disabled").find("i.fa").attr("class",o),n.status===401){$alert('需要登入才能够执行此操作！<a onclick="location.href = \'/login\';" href="javascript:;">点击登入...<\/a>',"warning");return}r?r(n):t?document.write(n.responseText):$alert("很抱歉，发生了错误！")}})};n.fn.loadModal=function(t){var r=this,i=r.dset("js-modal",function(){return n('<div class="js-modal modal fade" data-backdrop="static"><div>').appendTo(document.body).data("target",r.targetElement())});i.load(t,function(){var n=i.find("form");n.length>0&&(n.attr("action")||n.attr("action",t),n.find("input[type=file]").length>0&&n.attr("enctype","multipart/form-data"),i.find("[js-submit=true]").click(function(){n.formSubmit(function(n,t){var f=r.js("submit"),u;if(f){$call(r.js("submit"),n,t);return}if(n.message){if(u=i.find("div.modal-alert"),u.length>0&&n.type!=="success"){u.attr("class","modal-alert text-"+n.type).show().find(".errmsg").html(n.message);return}$alert(n.message,n.type,function(){n.data&&n.data.url?location.href=n.data.url:n.type==="success"&&(location.href=location.href)});n.type==="success"&&i.data("bs.modal").hide()}else n.data&&n.data.url?location.href=n.data.url:n.type==="success"&&(location.href=location.href)})}));$readyExec(i)}).modal()};window.$call=function(n){var t=window,u,r,i;n=n.split(".");for(u in n)t=t[n[u]];if(typeof t=="function"){for(r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);return t.apply(null,r)}return null};window.$alert=function(t,i,r){var u,f,e;(typeof t=="object"&&t&&(i=t.type,t=t.message),t)&&(u=n(document.body).dset("js-alert",function(){return n('<div class="js-alert modal fade" data-backdrop="static"><div class="modal-dialog"><div class="modal-content"><div class="modal-body" style="padding: 50px 30px 30px;"><div class="col-sm-2"><i style="font-size: 50px;"><\/i><\/div> <span class="col-sm-10" style="line-height: 26px; padding-left: 0;"><\/span><\/div><div class="modal-footer"><button type="button" class="btn btn-primary"><i class="fa fa-check"><\/i> 确定<\/button><\/div><\/div><\/div><\/div>').appendTo(document.body)}),f=u.find(".modal-body"),i=i||"warning",i==="success"?f.attr("class","modal-body row text-success").find("i").attr("class","fa fa-check"):f.attr("class","modal-body row text-"+i).find("i").attr("class","fa fa-warning"),f.find("span").html(t),e=u.find("button").attr("class","btn btn-"+i),r?e.removeAttr("data-dismiss").bind("click",function(){r(u.data("bs.modal"));u.data("bs.modal").hide()}):e.attr("data-dismiss","modal").unbind("click"),u.modal("show"))};window.$ajax=function(t,i,r,u){n("#js-loading").fadeIn();n.ajax({url:t,data:i,dataType:"JSON",type:"POST",success:function(t){n("#js-loading").fadeOut();var i=t.data&&r;t.message&&t.type&&$alert(t.message,t.type,t.type==="success"&&!i);i&&r(t.data)},error:function(t){if(n("#js-loading").fadeOut(),t.status===401){$alert('需要登陆才能够执行此操作！<a href="/login">点击登陆...<\/a>',"warning");return}u?u(t):document.write(t.responseText)}})};window.$readyExec=function(t){function i(i,r){var u=n("["+i+"]",t);u.length>0&&u.each(function(){var t=n(this),u=t.attr(i);t.hasClass("no-js")||u==="no-js"||r(t,u)})}i("_href",function(n,t){n.css("cursor","pointer").click(function(){var i=n.attr("target")||n.js("target");i?window.open(t,i):location.href=t})});i("_hover",function(t,i){t.mouseenter(function(t){var u=n(this),r=u.target();r.addClass(i);r.mouseleave(function(){r.removeClass(i)}).click(function(n){n.stopPropagation()});n(document).one("click",function(){r.removeClass(i)});t.stopPropagation()})});i("_focus",function(t,i){t.focusin(function(){n(this).targetElement().toggleClass(i)}).focusout(function(){n(this).targetElement().toggleClass(i)})});i("_click",function(t,i){t.click(function(){n(this).jsTarget().toggleClass(i)})});i("_modal",function(n,t){n.on("click",function(){return n.loadModal(n.js("url")||n.attr("href")||t),!1})});i("_action",function(n,t){n.on("click",function(){var r=n.js("confirm"),i;(!r||confirm(r))&&(i=n.js("error"),i&&(i=function(t){$call(n.js("error"),n,t)}),$ajax(t,{id:n.js("value")},function(t){var i=n.js("success");i?$call(i,n,t):location.href=location.origin+location.pathname},i))})});i("_maxlength",function(n,t){(t=parseInt(t),isNaN(t))||n.keyup(function(){var i=n.val().length;i>t&&(n.val(n.val().substr(0,t)),i=t);n.targetElement().html(i+" 个字符")})});window["mozlite-ready-functions"].forEach(function(n){n(t)})};Date.prototype.toFormatString=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};String.prototype.toJsonDateString=function(n){var t=new Date(this.replace("T"," "));return t.toFormatString(n||"yyyy-MM-dd hh:mm:ss")};String.prototype.randomSuffix=function(){return this.indexOf("?")===-1?this+"?_="+ +new Date:this+"&_="+ +new Date};window.$selectedText=function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().text:null};window.$selectedHtml=function(){if(window.getSelection){var t=window.getSelection().getRangeAt(0).cloneContents(),n=document.createElement("div");return n.appendChild(t),n.innerHTML}return document.selection?document.selection.createRange().htmlText:null};window.$replaceSelection=function(n){var i,t,r,u,e,f;if(window.getSelection){if(i=window.getSelection(),i.getRangeAt&&i.rangeCount){for(t=i.getRangeAt(0),t.deleteContents(),r=document.createElement("div"),r.innerHTML=n,u=document.createDocumentFragment();e=r.firstChild;)f=u.appendChild(e);t.insertNode(u);f&&(t=t.cloneRange(),t.setStartAfter(f),t.collapse(!0),i.removeAllRanges(),i.addRange(t))}}else document.selection&&document.selection.type!=="Control"&&document.selection.createRange().pasteHTML(n)};n.fn.mozmd=function(){return this.each(function(){var t=new i(this);return n(this).data("mozmd",t),t})}})(jQuery);$(document).ready(function(){window.$container=$("#modal-container");window.$container.length===0&&(window.$container=document.body);$readyExec()});$onready(function(n){$(".moz-checkbox",n).click(function(){$(this).toggleClass("checked");$(this).hasClass("checked")?$(this).find("input")[0].checked="checked":$(this).find("input").removeAttr("checked")});$(".moz-radiobox",n).click(function(){$(this).hasClass("checked")||($(this).parents(".moz-radioboxlist").find(".moz-radiobox").removeClass("checked").each(function(){$(this).find("input").removeAttr("checked")}),$(this).addClass("checked"),$(this).find("input")[0].checked="checked")});$(".mozmd",n).mozmd()});